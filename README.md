#Автоматизированная настройка сервера с помощью Ansible и Docker

## Описание проекта по тестовому заданию Betting Software
Проект предоставляет инфраструктуру для автоматической настройки и управления сервером с помощью **Ansible** и **Docker**. Основные функции включают:

1. **Управление пользователями** (создание пользователей, добавление SSH-ключей, установка паролей и групп)
2. **Настройка SSH** (безопасная конфигурация, запрет root-доступа, логирование)
3. **Установка и настройка Nginx** 
4. **Развертывание статических файлов**.
5. **Установка Zsh и Oh My Zsh** для пользователей
6. **Обновление и установка утилит**
7. **Docker-контейнеризация** для развертывания и тестирования

---
Изображения из задания раздаются по адресу **http://51.250.71.54/images**

## Структура проекта

├── ansible/                   # Каталог для Ansible-плейбуков и ролей
│   ├── playbook.yml           # Основной Ansible-плейбук
│   ├── inventory/             # Инвентори
│   │   ├── hosts              # Инвентори основной
│   │   └── hosts.yaml.old     # Архивный файл инвентори (формат yaml)
│   ├── roles/                 # Роли для Ansible
│   │   ├── apt/               # Роль для обновления и установки пакетов
│   │   │   ├── tasks/main.yml # Задачи для apt
│   │   │   └── defaults/main.yml
│   │   ├── nginx/             # Роль для установки и настройки Nginx
│   │   │   ├── tasks/main.yml # Задачи для Nginx
│   │   │   ├── handlers/main.yml # Обработчики
│   │   │   └── templates/nginx_vhost.conf.j2 # Jinja-шаблон
│   │   ├── ssh/               # Роль для конфигурации SSH
│   │   │   ├── tasks/main.yml # Задачи для SSH
│   │   │   └── handlers/main.yml # Обработчики
│   │   ├── static/            # Роль для развертывания статических файлов
│   │   │   ├── tasks/main.yml # Задачи для статических файлов
│   │   │   └── defaults/main.yml
│   │   ├── usermanager/       # Роль для управления пользователями
│   │   │   ├── tasks/main.yml # Основные задачи
│   │   │   ├── tasks/users.yml # Создание пользователей
│   │   │   ├── tasks/groups.yml # Управление группами
│   │   │   └── tasks/ssh.yml  # Управление SSH-ключами
│   │   ├── zsh/               # Роль для установки Zsh и Oh My Zsh
│   │   │   └── tasks/main.yml # Задачи для установки Zsh
│   └── vars/                  # Переменные для Ansible
│       ├── group_list.yml     # Список групп
│       ├── users_admin.yml    # Администраторские пользователи
│       ├── users_developer.yml # Пользователи-разработчики
│       ├── users_nopass.yml   # Пользователи без паролей
│       ├── users_olduser.yml  # Устаревшие пользователи
│       └── users_tester.yml   # Пользователи-тестеры
│
├── docker/                    # Каталог с Docker 
   ├── Dockerfile             # Dockerfile для создания образа
   ├── docker-compose.yml     # Композиция для запуска сервисов
   └── authorized_keys        # Авторизованные SSH-ключи для пользователей



# Основные роли Ansible

### 1. **apt** 
- Обновляет системные пакеты и устанавливает дополнительные утилиты.

### 2. **nginx**
- Устанавливает и настраивает Nginx с помощью Jinja-шаблона.

### 3. **ssh** 
- Запрещает root-доступ.
- Запрещает пустые пароли.
- Включает логирование в режиме **VERBOSE**.
- Отключает **X11Forwarding**.

### 4. **static**
- Копирует статические файлы в указанную директорию на сервере.

### 5. **usermanager**
- Создает пользователей.
- Добавляет SSH-ключи.
- Устанавливает пароли и группы.

### 6. **zsh**
- Устанавливает оболочку Zsh.
- Скачивает и устанавливает **Oh My Zsh** для пользователей с Zsh.

---


# Запуск проекта

### Шаг 1: Установка зависимостей
На хосте должны быть установлены:
- **Ansible**
- **Docker** и **docker-compose**

### Шаг 2: Запуск Docker-контейнера
Перейти в каталог docker и выполните команду:
```bash
docker-compose up -d
```bash

### Шаг 3: Запуск плейбука Ansible
Выполните команду для применения всех ролей:
```bash
ansible-playbook -i ansible/inventory/hosts ansible/playbook.yml
```bash


## Конфигурация пользователей
Список пользователей и их параметров задатся в переменных:

- `ansible/vars/users_admin.yml`
- `ansible/vars/users_developer.yml`
- `ansible/vars/users_tester.yml`
- и другие файлы в директории `vars`.

---

## Примечания
- **SSH-ключи**: Убедитесь, что файл `docker/authorized_keys` содержит корректные публичные SSH-ключи.  
- **Порты**: Nginx по умолчанию слушает порт `80`. При необходимости измените конфигурацию в файле `nginx_vhost.conf.j2`.
-**SSH подключение по паролю**: SSH подключение по паролю отключено. Для подлкючения к контейнеру под созданными пользователями нужно использовать связку ключей.
   Пример команды:
   ```bash
   ssh -i ~/.ssh/id_rsa -p 2222 admin@127.0.0.1
   ```bash
   
## Скриншоты
Скришоты для подтверждения удачного запуска проекта и демонстрации работы
   
   
   

   
   

